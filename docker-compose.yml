version: "3"

services:

    db:
       extends:
        file: ./apps/backend/docker-compose.yml
        service: db
        env_file:
            - ./apps/backend/.env
    redis:
       extends:
        file: ./apps/backend/docker-compose.yml
        service: redis
        env_file:
            - ./apps/backend/.env


    backend:
        restart: always
        build:
            context: ./apps/backend/
            dockerfile: ./apps/backend/Dockerfile
        env_file:
            - ./apps/backend/.env

        volumes:
            - /code
            - ./images:/app/backend/images/
        ports:
            - "5000:5000"
        depends_on:
            - db

    frontend:
        build: ./apps/frontend
        env_file:
            - ./apps/frontend/.env

        ports:
            - 3000:3000
        depends_on:
            - backend

    nginx:
        build: ./nginx
        ports:
            - 80:80
            - 443:443
        volumes:
            - ./images:/usr/share/nginx/food_pics:ro
        depends_on:
            - frontend
